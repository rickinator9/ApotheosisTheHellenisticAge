namespace = ancestry

## Investigation Phase
# 0001 - Starting Event
# 0002-0005 - Rumours of a Tomb
# 0006-0009 - A Hero's Equipment

#######################
# INVESTIGATION PHASE #
#######################

#Starting Event
ancestry.0001 = {
    type = character_event
    title = ancestry.0001.t
    desc = ancestry.0001.desc
    theme = diplomacy
    left_portrait = {
        character = root
        animation = personality_honorable
    }

    immediate = {
        set_variable = {
            name = ancestry_outcome
            value = 0
        }
        set_variable = {
            name = ancestry_discovery_risk
            value = 0
        }
    }

    option = { # Small investment
        name = ancestry.0001.a
        custom_tooltip = ancestry.0001.a_tt

        remove_short_term_gold = {
            add = medium_gold_value
            multiply = 2
        }
        trigger_event = ancestry.0006

        ai_chance = {
            base = 50
        }
    }
    option = { # Medium investment
        name = ancestry.0001.b
        custom_tooltip = ancestry.0001.b_tt

        remove_short_term_gold = {
            add = major_gold_value
            multiply = 2
        }
        trigger_event = ancestry.0002

        ai_chance = {
            base = 100
            modifier = {
                factor = 0.5
                short_term_gold < massive_gold_value
            }
            ai_value_modifier = {
                ai_greed = -0.5
                ai_honor = 0.5
            }
            modifier = {
                factor = 0
                short_term_gold <= major_gold_value
            }
        }
    }
    option = { # Large investment
        name = ancestry.0001.c
        custom_tooltip = ancestry.0001.c_tt

        remove_short_term_gold = {
            add = massive_gold_value
            multiply = 2
        }
        trigger_event = ancestry.0006

        stress_impact = {
            greedy = medium_stress_impact_gain
        }

        ai_chance = {
            base = 200
            modifier = {
                factor = 0.5
                short_term_gold < monumental_gold_value
            }
            ai_value_modifier = {
                ai_greed = -1
                ai_honor = 1
            }
            modifier = { # Weight down for stress.
                add = -20
                has_trait = greedy
            }
            modifier = {
                factor = 0
                short_term_gold <= massive_gold_value
            }
        }
    }
    option = { # Skip to preparation phase
        name = ancestry.0001.d
        custom_tooltip = ancestry.0001.d_tt

        trigger_event = ancestry.0006

        stress_impact = {
            honest = medium_stress_impact_gain
        }

        ai_chance = {
            base = 0
            ai_value_modifier = {
                ai_greed = 1
                ai_honor = -1
            }
            modifier = { # Weight down for stress.
                add = -20
                has_trait = honest
            }
        }
    }
}

#######################
# Rumours of a tomb   #
#######################

# Diplomacy-based event chain

#Chancellor approaches you concerning rumours of a tomb
ancestry.0002 = {
    type = character_event
    title = ancestry.0002.t
    desc = ancestry.0002.desc
    theme = diplomacy
    left_portrait = {
        character = root
        animation = personality_rational
    }
    right_portrait = {
        character = scope:chancellor
        animation = personality_compassionate
    }

    weight_multiplier = {
        base = 1
    }

    trigger = {
        NOT = { exists = scope:story.var:had_event_0002 }
        exists = cp:councillor_chancellor
    }

    immediate = {
        scope:story = {
            set_variable = {
                name = had_event_0002
                value = yes
            }
        }
        cp:councillor_chancellor = {
            if = {
                limit = { is_ai = yes }
                save_scope_as = chancellor
            }
        }
        random_sub_realm_barony = {
            limit = {
                county.holder = root
            }
            save_scope_as = barony
        }

        #Set random gender for loc
        random_list = {
            100 = {
                dummy_female = { save_scope_as = real_ancestor }
            }
            100 = {
                dummy_male = { save_scope_as = real_ancestor }
            }
        }
    }

    option = { # Begin a search for the tomb
        name = ancestry.0002.a

        duel = {
            skill = diplomacy
            value = average_skill_rating
            desc = outcome_in_a_few_weeks
            60 = {  
                desc = ancestry.0002.a_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 3.5
                    min = -49
                }
                trigger_event = {
                    id = ancestry.0003
                    days = { 14 21 }
                }
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            40 = {
                desc = ancestry.0002.a_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -1.5
                    min = -49
                }
                trigger_event = {
                    id = ancestry.0005
                    days = { 14 21 }
                }
                show_as_tooltip = {
                    add_prestige = medium_prestige_loss
                }
            }
        }
        add_character_modifier = {
            modifier = ancestry_looking_for_tomb_modifier
            years = 5
        }
        reverse_add_opinion = {
            target = scope:chancellor
            modifier = grateful_opinion
            opinion = 10
        }
        scope:chancellor = {
            hidden_effect  = {
                add_character_modifier = {
                    modifier = ancestry_looking_for_tomb_modifier
                    years = 5
                }   
            } 
        }

        ai_chance = {
            base = 100

            ai_value_modifier = {
                ai_boldness = 1
                ai_energy = 0.5
            }
        }
    }

    option = { # Don't investigate further
        name = ancestry.0002.b
        flavor = ancestry.0002.b_flavour

        # +1 claim strength
        ancestry_weak_evidence_effect = yes

        ai_chance = {
            base = 0
        }
    }
}

#You find the tomb
ancestry.0003 = {
    type = character_event
    title = ancestry.0003.t
    desc = ancestry.0003.desc
    theme = diplomacy
    left_portrait = {
        character = root
        animation = idle
    }
    right_portrait = {
        character = scope:chancellor
        animation = happiness
    }
    override_background = { reference = terrain_scope }

    trigger = {
    }

    immediate = {
        scope:barony.title_province = { save_scope_as = background_terrain_scope }
    }

    option = { # Enter the tomb
        name = ancestry.0003.a

        trigger_event = ancestry.0004

        hidden_effect = {
            random_list = {
                25 = { # Strong evidence
                    set_variable = {
                        name = tomb_strong_evidence
                        value = yes
                        days = 1
                    }
                }
                50 = { # Weak evidence
                    set_variable = {
                        name = tomb_weak_evidence
                        value = yes
                        days = 1
                    }
                }
                15 = { # Contradictory evidence
                    set_variable = {
                        name = tomb_contradictory_evidence
                        value = yes
                        days = 1
                    }
                }
                10 = { # Strong evidence for a *different* ancestor
                    set_variable = {
                        name = tomb_different_ancestor
                        value = yes
                        days = 1
                    }
                }
            }
        }

        stress_impact = {
            craven = minor_stress_impact_gain
        }
    }
}

#You enter the tomb
ancestry.0004 = {
    type = character_event
    title = ancestry.0004.t
    desc = {
        desc = ancestry.0004.desc
        triggered_desc = {
            trigger = { exists = var:tomb_strong_evidence }
            desc = ancestry.0004.desc_1
        }
        triggered_desc = {
            trigger = { exists = var:tomb_weak_evidence }
            desc = ancestry.0004.desc_2
        }
        triggered_desc = {
            trigger = { exists = var:tomb_contradictory_evidence }
            desc = ancestry.0004.desc_3
        }
        triggered_desc = {
            trigger = { exists = var:tomb_different_ancestor }
            desc = ancestry.0004.desc_4
        }
    }
    theme = diplomacy
    left_portrait = {
        character = root
        triggered_animation = {
            trigger = { exists = var:tomb_strong_evidence }
            animation = personality_honorable
        }
        triggered_animation = {
            trigger = { exists = var:tomb_weak_evidence }
            animation = personality_cynical
        }
        triggered_animation = {
            trigger = { exists = var:tomb_contradictory_evidence }
            animation = worry
        }
        triggered_animation = {
            trigger = { exists = var:tomb_different_ancestor }
            animation = personality_rational
        }
    }
    override_background = { reference = tomb }

    immediate = {
        character:test_herakles = { save_scope_as = new_ancestor } # TODO: Convert into scripted effect that pulls a random possible ancestor
    }

    #Strong evidence
    option = { # Okay
        name = ancestry.0004.1_a
        trigger = { exists = var:tomb_strong_evidence }

        # +3 claim strength
        ancestry_strong_evidence_effect = yes

        add_prestige = medium_prestige_gain
    }

    #Weak evidence
    option = { # Okay
        name = ancestry.0004.2_a
        trigger = { exists = var:tomb_weak_evidence }

        # +1 claim strength
        ancestry_weak_evidence_effect = yes

        add_prestige = minor_prestige_gain
        
        stress_impact = {
            ambitious = minor_stress_impact_gain
        }

        ai_chance = {
            base = 100

            modifier = { # Weight down for stress.
                add = -10
                has_trait = ambitious
            }
        }
    }
    option = { # Try fabricating strong evidence
        name = ancestry.0004.2_b
        trigger = { exists = var:tomb_weak_evidence }

        duel = {
            skill = diplomacy
            value = 10
            10 = {
                desc = ancestry.0004.2_b.critical_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 1.5
                }
                send_interface_toast = {
                    title = ancestry.0004.2_b.critical_success
                    left_icon = root

                    # +3 claim strength
                    ancestry_strong_evidence_effect = yes

                    add_prestige = medium_prestige_gain
                }
            }
            30 = {
                desc = ancestry.0004.2_b.success
                send_interface_toast = {
                    title = ancestry.0004.2_b.success
                    left_icon = root

                    # +3 claim strength
                    ancestry_strong_evidence_effect = yes

                    # +1 claim risk
                    ancestry_discovery_risk_effect = yes
                }
            }
            10 = {
                desc = ancestry.0004.2_b.failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.5
                }
                send_interface_toast = {
                    title = ancestry.0004.2_b.failure
                    left_icon = root

                    # +1 claim strength
                    ancestry_weak_evidence_effect = yes

                    # +1 claim risk
                    ancestry_discovery_risk_effect = yes

                    add_piety = minor_piety_loss
                }
            }
        }
        
        stress_impact = {
            honest = medium_stress_impact_gain
        }

        ai_chance = {
            base = 0

            modifier = {
                add = 100
                has_trait = deceitful
            }
            modifier = { # Weight down for stress.
                add = -20
                has_trait = honest
            }
            ai_value_modifier = {
                ai_honor = -2
                ai_boldness = 0.5
            }
        }
    }

    #Contradictory evidence
    option = { # Okay
        name = ancestry.0004.3_a
        trigger = { exists = var:tomb_contradictory_evidence }

        # -2 claim strength
        ancestry_contradictory_evidence_effect = yes

        add_prestige = medium_prestige_loss
        
        stress_impact = {
            base = medium_stress_impact_gain
        }

        ai_chance = {
            base = 100
        }
    }
    option = { # Try covering it up
        name = ancestry.0004.3_b
        trigger = { exists = var:tomb_contradictory_evidence }

        random_list = {
            80 = { # You successfully cover it up
                desc = ancestry.0004.3_b.success
                send_interface_toast = {
                    title = ancestry.0004.3_b.success
                    left_icon = root

                    # +1 claim risk
                    ancestry_discovery_risk_effect = yes
                }
            }
            20 = { # You do a poor job of covering it up
                desc = ancestry.0004.3_b.failure
                send_interface_toast = {
                    title = ancestry.0004.3_b.failure
                    left_icon = root

                    # -2 claim strength
                    ancestry_contradictory_evidence_effect = yes

                    # +1 claim risk
                    ancestry_discovery_risk_effect = yes

                    add_piety = medium_piety_loss
                }
            }
        }

        stress_impact = {
            base = minor_stress_impact_gain
            honest = minor_stress_impact_gain
            deceitful = medium_stress_impact_loss
        }

        ai_chance = {
            base = 50

            modifier = {
                add = 100
                has_trait = deceitful
            }
            modifier = { # Weight down for stress.
                add = -10
                has_trait = honest
            }
            ai_value_modifier = {
                ai_honor = -2
                ai_boldness = 0.5
            }
        }
    }
    option = { # Destroy the tomb
        name = ancestry.0004.3_c
        trigger = { exists = var:tomb_contradictory_evidence }

        random_list = {
            50 = { # No one notices
                desc = ancestry.0004.3_c.success
                send_interface_toast = {
                    title = ancestry.0004.3_b.success
                    left_icon = root
                }
            }
            25 = { # People find out
                desc = ancestry.0004.3_c.failure
                send_interface_toast = {
                    title = ancestry.0004.3_c.failure
                    left_icon = root

                    add_dread = minor_dread_gain
                    add_piety = major_piety_loss
                    scope:barony.county = {
                        add_county_modifier = {
                            modifier = tomb_defiler_modifier
                            years = 10
                        }
                    }
                }
            }
            25 = { # A bunch of local peasants stop you
                desc = ancestry.0004.3_c.critical_failure
                send_interface_toast = {
                    title = ancestry.0004.3_c.critical_failure
                    left_icon = root

                    # -2 claim strength
                    ancestry_contradictory_evidence_effect = yes

                    add_piety = major_piety_loss
                    scope:barony.county = {
                        add_county_modifier = {
                            modifier = tomb_defiler_modifier
                            years = 10
                        }
                    }
                }
            }
        }

        stress_impact = {
            base = minor_stress_impact_gain
            calm = minor_stress_impact_gain
            zealous = medium_stress_impact_gain
            callous = medium_stress_impact_loss
            sadistic = medium_stress_impact_loss
            vengeful = medium_stress_impact_loss
            wrathful = medium_stress_impact_loss
        }

        ai_chance = {
            base = 0

            modifier = {
                add = -100
                has_trait = zealous
            }
            modifier = { # Weight down for stress.
                add = -10
                has_trait = calm
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = callous
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = callous
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = sadistic
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = vengeful
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = wrathful
            }
            ai_value_modifier = {
                ai_honor = -2
                ai_zeal = -2
                ai_boldness = 0.5
            }
        }
    }

    #Strong evidence for a *different* ancestor
    option = { # Follow this new lead
        name = ancestry.0004.4_a
        custom_tooltip = ancestry.0004.4_a.tt
        custom_tooltip = ancestry.0004.4_a.tt_abandoned
        trigger = { exists = var:tomb_different_ancestor }

        # Reset claim strength
        set_variable = {
            name = ancestry_outcome
            value = 0
        }
        # Change scoped ancestor
        scope:new_ancestor = { save_scope_as = ancestor }

        # +3 claim strength for the new ancestor
        hidden_effect = {
            ancestry_strong_evidence_effect = yes
        }

        stress_impact = {
            stubborn = minor_stress_impact_gain
        }

        ai_chance = {
            base = 100

            modifier = { # Weight down for stress
                add = -20
                has_trait = stubborn
            }
            modifier = { # Shouldn't switch if the current investigation is going well
                add = -100
                var:ancestry_outcome > 3
            }
        }
    }
    option = { # Stick with current investigation
        name = ancestry.0004.4_b
        trigger = { exists = var:tomb_different_ancestor }

        ai_chance = {
            base = 0

            modifier = {
                add = 100
                has_trait = stubborn
            }
            modifier = { # Shouldn't switch if the current investigation is going well
                add = 100
                var:ancestry_outcome > 3
            }
        }
    }
}

#You can't find the tomb
ancestry.0005 = {
    type = character_event
    title = ancestry.0005.t
    desc = ancestry.0005.desc
    theme = diplomacy
    left_portrait = {
        character = root
        animation = personality_vengeful
    }
    right_portrait = {
        character = scope:chancellor
        animation = worry
    }
    override_background = { reference = terrain_scope }

    trigger = {
    }

    immediate = {
        scope:barony.title_province = { save_scope_as = background_terrain_scope }
        add_prestige = medium_prestige_loss
    }

    option = { # Give up
        name = ancestry.0005.a
        flavor = ancestry.0005.a_flavour

        add_opinion = {
            target = scope:chancellor
            modifier = annoyed_opinion
            opinion = -20
        }
        if = {
            limit = {
                NOR = { 
                    has_relation_rival = scope:chancellor
                    has_trait = forgiving 
                }
            }
            progress_towards_rival_effect = {
                CHARACTER = scope:chancellor
                OPINION = no
            }
        }

        stress_impact = {
            base = medium_stress_impact_gain
            impatient = minor_stress_impact_gain
            patient = medium_stress_impact_loss
        }

        ai_chance = {
            base = 100

            modifier = { # Weight down for stress.
                add = -10
                has_trait = impatient
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = patient
            }
        }
    }

    option = { # Kill the annoying chancellor (and give up)
        name = ancestry.0005.b
        flavor = ancestry.0005.b_flavour

        unknown_murder_effect = {
            VICTIM = scope:chancellor
            MURDERER = root
            REASON = death_accident
        }

        stress_impact = {
            base = minor_stress_impact_gain
            vengeful = medium_stress_impact_loss
            sadistic = medium_stress_impact_loss
            callous = medium_stress_impact_loss
            forgiving = medium_stress_impact_gain
            compassionate = medium_stress_impact_gain
            just = minor_stress_impact_gain
        }

        ai_chance = {
            base = 0

            modifier = {
                add = 100
                any_scheme = { #More likely if they have a murder scheme against the chancellor
                    scheme_type = murder
                    scheme_target = scope:chancellor
                }
            }
            modifier = {
                add = 100
                has_trait = sadistic
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = vengeful
            }
            modifier = { # Weight up for stress.
                add = 20
                has_trait = callous
            }
            modifier = { # Weight down for stress.
                add = -20
                has_trait = forgiving
            }
            modifier = { # Weight down for stress.
                add = -20
                has_trait = compassionate
            }
            modifier = { # Weight down for stress.
                add = -10
                has_trait = just
            }
            ai_value_modifier = {
                ai_honor = -2
                ai_compassion = -1
                ai_boldness = 0.5
            }
            modifier = {
                add = 100
                opinion = {
                    target = scope:chancellor
                    value <= -20
                }
            }
        }
    }
}

#######################
# A Hero's Equipment  #
#######################

# Martial-based event chain

#Martial approaches you about the equipment of an ancient hero
ancestry.0006 = {
    type = character_event
    title = ancestry.0006.t
    desc = ancestry.0006.desc
    theme = martial
    left_portrait = {
        character = root
        animation = personality_rational
    }
    right_portrait = {
        character = scope:marshal
        animation = personality_bold
    }

    weight_multiplier = {
        base = 1
    }

    trigger = {
        NOT = { exists = scope:story.var:had_event_0006 }
        # Make sure there is an appropriate character to approach you
        OR = {
            exists = cp:councillor_marshal
            any_knight = {
                can_be_commander_now_trigger = { ARMY_OWNER = root }
                is_available_ai_adult = yes
                NOT = { this = root.cp:councillor_marshal }
            }
        }
    }

    immediate = {
        scope:story = {
            set_variable = {
                name = had_event_0006
                value = yes
            }
        }
        if = {
            limit = { exists = cp:councillor_marshal }
            cp:councillor_marshal = {
                if = {
                    limit = { is_ai = yes }
                    save_scope_as = marshal
                }
            }
        }
        else = {
            random_knight = {
                limit = {
                    can_be_commander_now_trigger = { ARMY_OWNER = root }
                    is_available_ai_adult = yes
                    NOT = { this = root.cp:councillor_marshal }
                }
                save_scope_as = marshal
            }     
        }
        random_sub_realm_barony = {
            limit = {
                county.holder = root
            }
            save_scope_as = barony
        }

        #Set the type of equipment
        random_list = {
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:panoply
                }
            }
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:shield
                }
            }
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:helmet
                }
            }
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:breastplate
                }
            }
            1 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:greaves
                }
            }
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:sword
                }
            }
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:axe
                }
            }
            2 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:spear
                }
            }
            1 = {
                set_variable = {
                    name = ancestor_equipment
                    value = flag:chariot
                }
            }
        }

        #Set the evidence strength
        random_list = {
            25 = { # Strong evidence
                set_variable = {
                    name = ancestor_equipment_strong_evidence
                    value = yes
                    days = 8
                }
            }
            50 = { # Weak evidence
                set_variable = {
                    name = ancestor_equipment_weak_evidence
                    value = yes
                    days = 8
                }
            }
            15 = { # Contradictory evidence
                set_variable = {
                    name = ancestor_equipment_contradictory_evidence
                    value = yes
                    days = 8
                }
            }
            10 = { # Strong evidence for a *different* ancestor
                set_variable = {
                    name = ancestor_equipment_different_ancestor
                    value = yes
                    days = 8
                }
            }
        }

        #Set random gender for loc
        random_list = { #TODO: Update so it's based on culture's commander gender once RC comes out
            #100 = {
            #    dummy_female = { save_scope_as = real_ancestor }
            #}
            100 = {
                dummy_male = { save_scope_as = real_ancestor }
            }
        }
    }

    option = { # Take an aggressive approach
        name = ancestry.0006.a
        flavor = ancestry.0006.a_flavour

        set_variable = {
            name = ancestry_0006_approach
            value = flag:aggressive
            days = 8
        }
        duel = {
            skill = martial
            value = average_skill_rating
            desc = outcome_in_a_few_days

            20 = { # You massacre the bandits 
                desc = ancestry.0006.critical_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 3.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:critical_success_aggressive
                    days = 8
                }
                trigger_event = ancestry.0009
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            50 = { # You corner the bandits 
                desc = ancestry.0006.success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 1.5
                    min = -49
                }
                trigger_event = ancestry.0007
                custom_tooltip = ancestry.0006.success.tt
            }
            10 = { # The bandits escape 
                desc = ancestry.0006.failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.25
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_aggressive
                    days = 8
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = minor_prestige_loss
                }
            }
            20 = { # You are captured and humiliated by the bandits 
                desc = ancestry.0006.critical_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:critical_failure_aggressive
                    days = 8
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = major_prestige_loss
                    remove_short_term_gold = massive_gold_value
                }
            }
        }
        add_character_modifier = {
            modifier = ancestry_hunting_bandits_modifier
            years = 5
        }
        reverse_add_opinion = {
            target = scope:marshal
            modifier = grateful_opinion
            opinion = 10
        }
        scope:marshal = {
            hidden_effect  = {
                add_character_modifier = {
                    modifier = ancestry_hunting_bandits_modifier
                    years = 5
                }   
            } 
        }

        ai_chance = {
            base = 100

            ai_value_modifier = {
                ai_boldness = 1
                ai_energy = 0.5
            }
        }
    }

    option = { # Take a more cautious approach
        name = ancestry.0006.b
        flavor = ancestry.0006.b_flavour

        set_variable = {
            name = ancestry_0006_approach
            value = flag:cautious
            days = 8
        }
        duel = {
            skill = martial
            value = average_skill_rating
            desc = outcome_in_a_few_days

            10 = { # You massacre the bandits 
                desc = ancestry.0006.critical_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 3.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:critical_success_cautious
                    days = 8
                }
                trigger_event = ancestry.0009
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            40 = { # You corner the bandits 
                desc = ancestry.0006.success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 1.5
                    min = -49
                }
                trigger_event = ancestry.0007
                custom_tooltip = ancestry.0006.success.tt
            }
            40 = { # The bandits escape 
                desc = ancestry.0006.failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.25
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_cautious
                    days = 8
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = minor_prestige_loss
                }
            }
            10 = { # You are captured and humiliated by the bandits 
                desc = ancestry.0006.critical_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:critical_failure_cautious
                    days = 8
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = major_prestige_loss
                    remove_short_term_gold = massive_gold_value
                }
            }
        }
        add_character_modifier = {
            modifier = ancestry_hunting_bandits_modifier
            years = 5
        }
        reverse_add_opinion = {
            target = scope:marshal
            modifier = grateful_opinion
            opinion = 10
        }
        scope:marshal = {
            hidden_effect  = {
                add_character_modifier = {
                    modifier = ancestry_hunting_bandits_modifier
                    years = 5
                }   
            } 
        }

        ai_chance = {
            base = 100

            ai_value_modifier = {
                ai_boldness = 1
                ai_energy = 0.5
            }
        }
    }

    option = { # Take a stealthy approach
        name = ancestry.0006.c
        flavor = ancestry.0006.c_flavour

        set_variable = {
            name = ancestry_0006_approach
            value = flag:stealth
            days = 8
        }
        duel = {
            skill = intrigue
            value = average_skill_rating
            desc = outcome_in_a_few_days

            40 = { # You successfully steal the item 
                desc = ancestry.0006.c_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 3.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:success_stealth
                    days = 8
                }
                trigger_event = ancestry.0009
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            3000 = { # The bandits are alerted and try to stop you 
                desc = ancestry.0006.c_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.25
                    min = -49
                }
                trigger_event = ancestry.0008
                custom_tooltip = ancestry.0006.c_failure.tt
            }
            30 = { # You are captured and humiliated by the bandits 
                desc = ancestry.0006.critical_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:critical_failure_stealth
                    days = 8
                }
                hidden_effect = {
                    #Create the bandit leader
                    create_character = {
                        trait = giant
                        location = scope:barony
                        template = new_warrior_character
                        faith = scope:barony.county.faith
                        culture = scope:barony.county.culture
                        dynasty = none
                        save_scope_as = bandit
                    }
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = major_prestige_loss
                    remove_short_term_gold = massive_gold_value
                }
            }
        }
        reverse_add_opinion = {
            target = scope:marshal
            modifier = grateful_opinion
            opinion = 10
        }

        ai_chance = {
            base = 0
        }
    }

    option = { # Don't investigate further
        name = ancestry.0006.d
        flavor = ancestry.0006.d_flavour

        # +1 claim strength
        ancestry_weak_evidence_effect = yes

        ai_chance = {
            base = 0
        }
    }
}

#Corner bandit who has the hero's equipment
ancestry.0007 = {
    type = character_event
    title = ancestry.0007.t
    desc = {
        first_valid = {
            triggered_desc = {
                trigger = { var:ancestry_0006_approach = flag:aggressive }
                desc = ancestry.0007.desc.approach_aggressive
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_approach = flag:cautious }
                desc = ancestry.0007.desc.approach_cautious
            }
        }
        desc = ancestry.0007.desc
    }
    theme = martial
    left_portrait = {
        character = scope:bandit
        animation = anger
    }
    override_background = { reference = burning_building }

    immediate = {
        #To create the bandit
        create_character = {
            trait = giant
            location = scope:barony
            template = new_warrior_character
            faith = scope:barony.county.faith
            culture = scope:barony.county.culture
            dynasty = none
            save_scope_as = bandit
        }
    }

    option = { # Duel the bandit
        name = ancestry.0007.a

        set_variable = {
            name = ancestry_0007_approach
            value = flag:duel
            days = 1
        }
        duel = {
            skill = prowess
            value = scope:bandit.prowess
            80 = { # You win the duel
                desc = ancestry.0007.a_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 3.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:success_duel
                    days = 1
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    scope:bandit = {
                        death = {
                            killer = root
                            death_reason = death_duel
                        }
                    }
                }
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            20 = { # You are wounded and the bandit escapes
                desc = ancestry.0007.a_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_duel
                    days = 1
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    increase_wounds_effect = { REASON = duel }
                    add_prestige = minor_prestige_loss
                }
            }
            0 = { # The bandit straight up murders you
                desc = ancestry.0007.a_critical_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -0.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:critical_failure_duel
                    days = 1
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    death = {
                        killer = scope:bandit
                        death_reason = death_duel
                    }
                }
            }
        }

        ai_chance = {
            base = 100
        }
    }

    option = { # Wait for backup
        name = ancestry.0007.b

        set_variable = {
            name = ancestry_0007_approach
            value = flag:wait
            days = 1
        }
        random_list = {
            50 = { # Backup arrives in time
                desc = ancestry.0007.b_success
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:success_wait
                    days = 1
                }
                trigger_event = ancestry.0009
                custom_tooltip = ancestry.claim_strength_opportunity.tt
                show_as_tooltip = {
                    scope:bandit = {
                        death = { death_reason = death_duel }
                    }
                }
            }
            50 = { # The bandit escapes
                desc = ancestry.0007.b_failure
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_wait
                    days = 1
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = minor_prestige_loss
                }
            }
        }

        ai_chance = {
            base = 100
        }
    }
}

#You alert the bandits to your presence
ancestry.0008 = {
    type = character_event
    title = ancestry.0008.t
    desc = {
        desc = ancestry.0008.desc.approach_stealth
        first_valid = {
            triggered_desc = {
                trigger = { var:ancestor_equipment = flag:chariot }
                desc = ancestry.0008.desc.outcome_chariot
            }
            desc = ancestry.0008.desc.outcome
        }
        desc = ancestry.0008.desc.ending
    }
    theme = martial
    left_portrait = {
        character = root
        animation = paranoia
    }
    override_background = { reference = corridor_night }

    immediate = {
    }

    option = { # Fight your way out
        name = ancestry.0008.a

        set_variable = {
            name = ancestry_0008_approach
            value = flag:fight
            days = 1
        }
        duel = {
            skill = prowess
            value = average_skill_rating
            5000 = { # You make it out with the equipment
                desc = ancestry.0008.a_success
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = 3.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:success_fight
                    days = 1
                }
                trigger_event = ancestry.0009
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            50 = { # The bandits overwhelm you and humiliate you
                desc = ancestry.0008.a_failure
                compare_modifier = {
                    value = scope:duel_value
                    multiplier = -3.5
                    min = -49
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_fight
                    days = 1
                }
                trigger_event = ancestry.0009
                show_as_tooltip = {
                    add_prestige = major_prestige_loss
                    remove_short_term_gold = massive_gold_value
                }
            }
        }

        ai_chance = {
            base = 100
        }
    }

    option = { # Run!
        name = ancestry.0008.b

        add_prestige = medium_prestige_loss
        set_variable = {
            name = ancestry_0008_approach
            value = flag:run
            days = 1
        }
        random_list = {
            40 = { # You make it out with the equipment
                desc = ancestry.0008.b_success
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:success_run
                    days = 1
                }
                trigger_event = ancestry.0009
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            60 = { # You lose the equipment in the confusion
                desc = ancestry.0008.b_failure
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_run
                    days = 1
                }
                trigger_event = ancestry.0009
            }
        }

        ai_chance = {
            base = 100
        }
    }

    option = { # Get in the chariot!
        name = ancestry.0008.c
        custom_tooltip = ancestry.0008.c_tt

        trigger = { var:ancestor_equipment = flag:chariot }
        add_internal_flag = special

        set_variable = {
            name = ancestry_0008_approach
            value = flag:chariot
            days = 1
        }
        random_list = {
            95 = { # You Blues Brothers your way out
                desc = ancestry.0008.c_success
                modifier = { # Don't drive under the influence
                    add = -15
                    OR = {
                        has_trait = drunkard
                        has_trait = hashishiyah
                    }
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:success_chariot
                    days = 1
                }
                trigger_event = ancestry.0010
                custom_tooltip = ancestry.claim_strength_opportunity.tt
            }
            5 = { # You die in a spectacular crash
                desc = ancestry.0008.c_failure
                modifier = { # Don't drive under the influence
                    add = 15
                    OR = {
                        has_trait = drunkard
                        has_trait = hashishiyah
                    }
                }
                set_variable = {
                    name = ancestry_0006_outcome
                    value = flag:failure_chariot
                    days = 1
                }
                trigger_event = ancestry.0010
                show_as_tooltip = {
                    death = {
                        death_reason = death_chariot_accident
                    }
                }
                custom_tooltip = ancestry.0008.c.tt_claim_strength_opportunity
            }
        }

        ai_chance = {
            base = 100
        }
    }
}

scripted_trigger ancestry_0009_success_trigger = {
    OR = {
        var:ancestry_0006_outcome = flag:critical_success_aggressive
        var:ancestry_0006_outcome = flag:critical_success_cautious
        var:ancestry_0006_outcome = flag:success_stealth
        var:ancestry_0006_outcome = flag:success_duel
        var:ancestry_0006_outcome = flag:success_wait
        var:ancestry_0006_outcome = flag:success_fight
        var:ancestry_0006_outcome = flag:success_run
    }
}

#Outcome event for for ancestry.0006
ancestry.0009 = {
    type = character_event
    title = ancestry.0009.t
    desc = {
        #Approach
        first_valid = {
            triggered_desc = {
                trigger = { var:ancestry_0007_approach = flag:duel }
                desc = ancestry.0009.desc.approach_duel
            }
            triggered_desc = {
                trigger = { var:ancestry_0007_approach = flag:wait }
                desc = ancestry.0009.desc.approach_wait
            }
            triggered_desc = {
                trigger = { var:ancestry_0008_approach = flag:fight }
                desc = ancestry.0009.desc.approach_fight
            }
            triggered_desc = {
                trigger = { var:ancestry_0008_approach = flag:run }
                desc = ancestry.0009.desc.approach_run
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_approach = flag:aggressive }
                desc = ancestry.0009.desc.approach_aggressive
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_approach = flag:cautious }
                desc = ancestry.0009.desc.approach_cautious
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_approach = flag:stealth }
                desc = ancestry.0009.desc.approach_stealth
            }
        }
        #Outcome
        first_valid = {
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:critical_success_aggressive }
                desc = ancestry.0009.desc.outcome_critical_success_aggressive
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_aggressive }
                desc = ancestry.0009.desc.outcome_failure_aggressive
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:critical_failure_aggressive }
                desc = ancestry.0009.desc.outcome_critical_failure_aggressive
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:critical_success_cautious }
                desc = ancestry.0009.desc.outcome_critical_success_cautious
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_cautious }
                desc = ancestry.0009.desc.outcome_failure_cautious
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:critical_failure_cautious }
                desc = ancestry.0009.desc.outcome_critical_failure_cautious
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_stealth }
                desc = ancestry.0009.desc.outcome_success_stealth
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:critical_failure_stealth }
                desc = ancestry.0009.desc.outcome_critical_failure_stealth
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_duel }
                desc = ancestry.0009.desc.outcome_success_duel
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_duel }
                desc = ancestry.0009.desc.outcome_failure_duel
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:critical_failure_duel }
                desc = ancestry.0009.desc.outcome_critical_failure_duel
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_wait }
                desc = ancestry.0009.desc.outcome_success_wait
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_wait }
                desc = ancestry.0009.desc.outcome_failure_wait
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_fight }
                desc = ancestry.0009.desc.outcome_success_fight
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_fight }
                desc = ancestry.0009.desc.outcome_failure_fight
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_run }
                desc = ancestry.0009.desc.outcome_success_run
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_run }
                desc = ancestry.0009.desc.outcome_failure_run
            }
        }
        #Ending
        first_valid = {
            triggered_desc = { # Examine hero's equipment once the fighting has ceased 
                trigger = { 
                    OR = {
                        var:ancestry_0006_outcome = flag:critical_success_aggressive
                        var:ancestry_0006_outcome = flag:critical_success_cautious
                    }
                }
                desc = ancestry.0009.desc.ending_success
            }
            triggered_desc = { # Examine hero's equipment once you've killed the bandit 
                trigger = { 
                    OR = {
                        var:ancestry_0006_outcome = flag:success_duel
                        var:ancestry_0006_outcome = flag:success_wait
                    }
                }
                desc = ancestry.0009.desc.ending_success_duel
            }
            triggered_desc = { # You are helped up by your comrades and head home 
                trigger = { var:ancestry_0006_outcome = flag:failure_duel }
                desc = ancestry.0009.desc.ending_failure_duel
            }
            triggered_desc = { # Examine hero's equipment once you're at a safe distance 
                trigger = { var:ancestry_0006_outcome = flag:success_stealth }
                desc = ancestry.0009.desc.ending_success_stealth
            }
            triggered_desc = { # Examine hero's equipment once you've lost your pursuers 
                trigger = { 
                    OR = {
                        var:ancestry_0006_outcome = flag:success_fight
                        var:ancestry_0006_outcome = flag:success_run
                    }
                }
                desc = ancestry.0009.desc.ending_success_escape
            }
            triggered_desc = { # You get to the shrine, but there's nothing there! 
                trigger = { 
                    OR = {
                        var:ancestry_0006_outcome = flag:failure_aggressive
                        var:ancestry_0006_outcome = flag:failure_cautious
                    }
                }
                desc = ancestry.0009.desc.ending_failure_battle
            }
            triggered_desc = { # You realise you were killed with ancestor's weapon 
                trigger = { 
                    exists = var:ancestor_equipment_strong_evidence
                    var:ancestry_0006_outcome = flag:critical_failure_duel
                    OR = {
                        var:ancestor_equipment = flag:sword
                        var:ancestor_equipment = flag:axe
                        var:ancestor_equipment = flag:spear
                    }
                }
                desc = ancestry.0009.desc.ending_death_ironic
            }
            triggered_desc = { # You die realising your efforts were all for nothing
                trigger = { 
                    exists = var:ancestor_equipment_contradictory_evidence
                    var:ancestry_0006_outcome = flag:critical_failure_duel
                }
                desc = ancestry.0009.desc.ending_death_futile
            }
            triggered_desc = { # You die
                trigger = { var:ancestry_0006_outcome = flag:critical_failure_duel }
                desc = ancestry.0009.desc.ending_death
            }
            # You contemplate your failure
            desc = ancestry.0009.desc.ending_failure
        }
    }
    theme = martial
    left_portrait = {
        character = root
        animation = personality_honorable
    }

    immediate = {
    }

    option = { # Examine the artifact (success)
        name = ancestry.0009.a
        trigger = { ancestry_0009_success_trigger = yes }

        if = {
            limit = { var:ancestry_0006_outcome = flag:success_duel }
            scope:bandit = {
                death = {
                    killer = root
                    death_reason = death_duel
                }
            }
        }
        else_if = {
            limit = { var:ancestry_0006_outcome = flag:success_wait }
            scope:bandit = {
                death = { death_reason = death_duel }
            }
        }
    }

    option = { # It was not meant to be (failure)
        name = {
            trigger = { always = no }
            text = ancestry.0009.b
        }
        name = {
            trigger = {
                var:ancestry_0006_outcome = flag:critical_failure_duel
                NOR = {
                    exists = var:ancestor_equipment_contradictory_evidence
                    AND = {
                        exists = var:ancestor_equipment_strong_evidence
                        OR = {
                            var:ancestor_equipment = flag:sword
                            var:ancestor_equipment = flag:axe
                            var:ancestor_equipment = flag:spear
                        }
                    }
                }
            }
            text = ancestry.0009.b_death
        }
        name = {
            trigger = {
                var:ancestry_0006_outcome = flag:critical_failure_duel
                exists = var:ancestor_equipment_strong_evidence
                OR = {
                    var:ancestor_equipment = flag:sword
                    var:ancestor_equipment = flag:axe
                    var:ancestor_equipment = flag:spear
                }
            }
            text = ancestry.0009.b_death_ironic
        }
        name = {
            trigger = { exists = var:ancestor_equipment_contradictory_evidence }
            text = ancestry.0009.b_death_futile
        }
        trigger = { ancestry_0009_success_trigger = no }

        flavor = {
            triggered_desc = {
                trigger = {
                    var:ancestry_0006_outcome = flag:critical_failure_duel
                    exists = var:ancestor_equipment_strong_evidence
                    OR = {
                        var:ancestor_equipment = flag:sword
                        var:ancestor_equipment = flag:axe
                        var:ancestor_equipment = flag:spear
                    }
                }
                desc = ancestry.0009.b_death_ironic.tt
            }
            triggered_desc = {
                trigger = { exists = var:ancestor_equipment_contradictory_evidence }
                desc = ancestry.0009.b_death_futile.tt
            }
        }
        if = {
            limit = {
                OR = {
                    var:ancestry_0006_outcome = flag:failure_aggressive
                    var:ancestry_0006_outcome = flag:failure_cautious
                    var:ancestry_0006_outcome = flag:failure_wait
                }
            }
            add_prestige = minor_prestige_loss
        }
        else_if = {
            limit = {
                OR = {
                    var:ancestry_0006_outcome = flag:critical_failure_aggressive
                    var:ancestry_0006_outcome = flag:critical_failure_cautious
                    var:ancestry_0006_outcome = flag:critical_failure_stealth
                    var:ancestry_0006_outcome = flag:failure_fight
                }
            }
            add_prestige = major_prestige_loss
            remove_short_term_gold = massive_gold_value
        }
        else_if = {
            limit = { var:ancestry_0006_outcome = flag:failure_duel }
            increase_wounds_effect = { REASON = duel }
            add_prestige = minor_prestige_loss
        }
        else_if = {
            limit = { var:ancestry_0006_outcome = flag:critical_failure_duel }
            death = {
                killer = scope:bandit
                death_reason = death_duel
            }
            if = {
                limit = {
                    exists = var:ancestor_equipment_strong_evidence
                    OR = {
                        var:ancestor_equipment = flag:sword
                        var:ancestor_equipment = flag:axe
                        var:ancestor_equipment = flag:spear
                    }
                }
                # +1 claim strength (a slight consolation for getting murked by your own ancestor's weapon)
                ancestry_weak_evidence_effect = yes
            }
        }
    }
}


#Grand theft chariot (special outcome event)
ancestry.0010 = {
    type = character_event
    title = ancestry.0010.t
    desc = {
        desc = ancestry.0010.desc.opening
        first_valid = {
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_chariot }
                desc = ancestry.0010.desc.success
            }
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:failure_chariot }
                desc = ancestry.0010.desc.failure
            }
        }
        first_valid = {
            triggered_desc = {
                trigger = { var:ancestry_0006_outcome = flag:success_chariot }
                desc = ancestry.0009.0010.ending_success
            }
            triggered_desc = {
                trigger = { exists = var:ancestor_equipment_strong_evidence }
                desc = ancestry.0009.desc.ending_strong_evidence
            }
            triggered_desc = {
                trigger = { exists = var:ancestor_equipment_weak_evidence }
                desc = ancestry.0009.desc.ending_weak_evidence
            }
            triggered_desc = {
                trigger = { exists = var:ancestor_equipment_contradictory_evidence }
                desc = ancestry.0009.desc.ending_contradictory_evidence
            }
            triggered_desc = {
                trigger = { exists = var:ancestor_equipment_different_ancestor }
                desc = ancestry.0009.desc.ending_different_ancestor
            }
        }
    }
    theme = martial
    left_portrait = {
        character = root
        animation = personality_honorable
    }

    immediate = {
    }

    option = { # What could have been...
        name = ancestry.0009.a
        trigger = {
            exists = var:ancestor_equipment_different_ancestor 
            var:ancestry_0006_outcome = flag:failure_chariot
        }

        ai_chance = {
            base = 100
        }
    }
}